---
title: "Bayesian inference of material culture phylogenies using continuous traits: A birth–death model for Late Neolithic/Early Bronze Age arrowheads from Northwestern Europe"
author:
  - Ben Marwick:
      correspondence: "yes"
      email: bmarwick@uw.edu
      orcid: 0000-0001-7879-4531
      institute:
        - uw
  - David N. Matzig:
      institute: au
      orcid: 0000-0001-7349-5401
  - Felix Riede:
      institute: au
      orcid: 0000-0002-4879-7157
institute:
  - uw:
      name: Department of Anthropology, University of Washington, Seattle, USA
  - au: Department of Archaeology and Heritage Studies, Aarhus University, Denmark
title-block-published: "Last updated"  
date: now
date-format: long
format: 
  docx:
    reference-doc: "../templates/template.docx" # Insert path for the DOCX file
execute:
  echo: false
  warning: false
  message: false
  comment: "#>"
  fig-path: "../figures/"
  fig-dpi: 600
filters:
  - ../templates/scholarly-metadata.lua
  - ../templates/author-info-blocks.lua
  - ../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  The twentieth century saw two modes of thinking spread through biological systematics:  population thinking and tree thinking. Many archaeologists investigating ancient technologies have adopted the population thinking approach for archaeological systematics, as evident from the rise of work on quantifiable, attribute-based patterns of diversity in studies of past technological systems, much of it driven by application of geometric morphometrics. Yet, tree thinking, as one of the central concepts of phylogenetic biology, remains rare in the archaeological sciences. We review some of the obstacles that have impeded the uptake of this concept by archaeologists. Some of these are conceptual, but we also identify one specific methodological obstacle: the prevailing use of discrete character traits in phylogenetic analysis. This is a major challenge for archaeological applications where standardised trait-analytical protocols are scarce. To address this challenge, we present a case study that demonstrates a Bayesian framework for inferring phylogenies using continuous traits derived from artefact shape coefficients obtained via outline based geometric morphometrics. We use a previously published sample of Late Neolithic/Early Bronze Age arrowheads from Northwestern Europe to demonstrate the efficacy and accessibility of our approach. We also sketch out the potential for phylogenetic comparative methods to address archaeological questions. 
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- tweet thread with many links to our stuff is here https://twitter.com/benmarwick/status/1403246755118948355 -->

<!-- The actual document text starts here: -->

# Introduction

Two concepts derived from evolutionary theory have been highly generative in advancing understanding in biology: population thinking and tree thinking [@ohara1997]. While population thinking has has widespread influence among archaeologists, tree thinking has not. In this paper we identify three obstacles preventing tree thinking in archaeology. We find the limitation to parsimony methods using discrete character data to be a key reason for stagnation in tree thinking among archaeologists. We aim to motivate and sketch a workflow for overcoming this limitation. We draw on recent developments in paleontological systematics that enable the use of continuous trait data in a Bayesian inference framework for estimation of phylogeny. We demonstrate this workflow with a case study of previously published sample of Late Neolithic/Early Bronze Age arrowheads from Northwestern Europe to demonstrate the efficacy and accessibility of our approach.

## Population thinking and tree thinking

Population thinking, emerging from the Modern Synthesis of the 1930s and 1940s, rejects the essentialist idea that species have individual types or natural states, and instead understands variation within a species as the result of ongoing evolutionary events and processes. Archaeologists are similarly moving towards a more complete embrace of population thinking. Following the now defunct use of artefact typologies to infer a unilinear evolution of human development, and the realisation that traditional typologies often fail to account for the internal variation seen in artefact classes, there is a strong current of quantitatively and technologically oriented studies of variation among archaeological artefacts. Many archaeologists, especially those analysing stone artefacts, now reject typological approaches as overly subjective uncontrolled mixtures of technological and functional variables that often incorporate untested assumptions about the cognitive abilities and cultural organisation of hominins [see @bisson2000; @monnier2014; @riede2019reconciling; @riede2020cultural; @shea2014; @wilkins2020]. In parallel with these critiques, archaeologists have been active developing accessible and reproducible methods for geometric morphometric analysis of artefacts [@Cardillo_Charlin_2018; @cortell-nicolau2023; @radinovic2021; @selden2023; @wang2020; @matzig2021; @ivanovait2020]. These morphometric studies often critique established typologies, accelerating the move towards population thinking in archaeology. Furthermore, archaeologists have been successful recognizing the long-run effects of distinct cultural transmission mechanisms in archaeological assemblages, especially from dense and temporally shallow contexts, for example, projectile points from Pueblo households [@garveyraven2018], during the transition from the atlatl to the bow and arrow during the Late Holocene across the Great Basin [@bettinger1999], and Neolithic pottery from an archaeological assemblage in Western Germany [@cremaRevealingPatternsCultural2016].

While population thinking has become established and productive in many areas of archaeology, tree thinking remains rare. In their bibliometric analysis of cultural evolutionary theory and methods in archaeology @matzig2023 found stagnation and decline in the application of phylogenetic methods. This is in striking contrast to the biological sciences, where tree thinking permeates nearly every branch with myriad and transformative applications, from discovering the features present in ancestral organisms, to finding the sources of invasive species and infectious diseases. Tree thinking is the phylogenetic complement to population thinking, considering species as historically connected by inheritance and descent [@ohara1997]. For example, groups of species are connected by inheritance in ways that are different from groups of landforms and minerals, because members of these groups are independent replicates of each other. Importantly for archaeologists, connection by inheritance is not exclusive to biological organisms. For example, asteroids have been clustered into 'families' that have been found to inherit patterns of orbital motion from their ancestral asteroid from which they broke off [@milani1994]. These asteroids are not independent replicates, but are parts of a tree of inheritance with their common characteristics due to their shared history.

## Why is tree thinking rare in archaeology?

Why have archaeologists been reluctant to employ tree thinking in artefact analysis? Three factors seem likely: developmental thinking, rejection of Darwinian principles to explain artifact variation; and limitations of analytical tools. Developmental thinking misinterprets evolutionary history as a teleological interpretation of individual development. This is a widespread misunderstanding of evolution as documenting 'The Great Chain of Being' [@lovejoy2011; @nee2005 ], where phylogenetic diagrams are mistakenly thought to depict the progression from 'simpler' organisms to more 'advanced' ones [@gregory2008; @meisel2010; @torrens2012]. Many archaeologists likely share these misunderstandings and reject phylogenetic reconstructions of material culture histories as part of their rejection of racist nineteenth century notions about the ladder of progress driving human cultural change. This rejection of racist thought important and laudable, but phylogenetics is not intrinsically racist and continues to be a valuable component of contemporary evolutionary theory.

Our second factor, the rejection of Darwinian principles to explain artifact variation artifacts, is at the heart of one of the core debates in anthropology about the processes responsible for producing the cultural similarities and differences among human populations. This is the debate over whether ethnogenesis or phylogenesis is the dominant cultural evolutionary process [@tehrani2002]. Supporters of the ethnogenesis hypothesis claim that constant borrowing and blending of cultural traits due to trade and exchange erases the historical connections needed for phylogenetic modelling, and so cultural relationships are best depicted with network diagrams [@dewar1995; @moon1994; @terrell1988; @temkinPhylogeneticsMaterialCultural2007]. On the other hand, the phylogenesis hypothesis assumes that within-group, vertical, between-generation transmission of cultural information and population fissioning are the main processes in generating cultural variation, which can be usefully represented with tree diagrams [@collard2017]. While critics of the phylogenesis hypothesis argue that blending processes have always been more important in cultural evolution than the branching process of population fissioning, this is not supported by empirical comparisons across 42 samples of biological and cultural data which finds that cultural data sets are not less tree-like than are the biological data sets[@collard2006]. Similarly, simulations show that phylogenetic approaches to cultural evolution are robust to realistic levels of horizontal transmission between cultures [@greenhill2009does; @currie2010]. At any rate, the debate is not whether the history of a culture variant can be depicted as a tree, but rather how well a tree-like model depicts its history; trees are either more or less useful, rather than true or false [@skála1994].

```{r}
arch_phylo_papers <-
  readxl::read_excel(here::here("analysis/data/raw_data/Archaeology phylogenetics case studies.xlsx"))

n_papers <- nrow(arch_phylo_papers)
```

Our third factor behind the reluctance of archaeologists to employ three thinking is the practical limitations of analytical tools. We reviewed `r n_papers` publications of archaeological phylogenetic studies and found that a low diversity in approaches [@fig-bibliometrics]. Most case studies use discrete characters, which are artefact attributes that are classifiable (e.g. the presence or absence of fluting, the shape of the tang on a stone point, the style of basket weaving) or countable (e.g. the number of hearths or posts in a house). This can be contrasted with a virtual absence of studies using continuous attributes, which are measurable (rather than countable), and may take an infinite number of values between any two values (e.g. length, angle, mass). The rarity of continuous attributes may seem puzzling, since so many defining attributes of artefact variation are measurements rather than counts. In most previous archaeological phylogenetic studies linear measurements were discretized into categories (e.g. length-width ratio classes of 1-1.99, 2-2.99, 3-3.99, etc.). Why would archaeologists do this, given that discretizing continuous data results in information loss, including the potential disappearance of important patterns [@stanczykDiscretisationConditionsDecision2020]? The reason is that the most commonly used software for archaeological phylogenetics, PAUP\* [@wilgenbuschInferringEvolutionaryTrees2003; @swofford2003phylogeny], for many years could only work with discrete characters. This is because the computational tooling for phylogenetics is largely driven by the needs of researchers working with DNA or protein sequences, where the data are discrete characters such as the nucleotides A, C, G, and T (i.e. DNA sequences) or symbols representing common amino acids (i.e. protein sequences).

Similarly ubiquitous discrete characters are rarely found in archaeological data. Obviously artefacts (unfortunately) do not have base pairs, but the scarcity of standardised trait-analytical protocols in archaeology may not be entirely due to the nature of archaeological data itself. Archaeological data collection is typically slow and labor-intensive, affording high flexibility and local control, but resulting in datasets that are often not consistent in form or structure and thus hard to reuse for synthetic research [@sobotkovaSociotechnicalObstaclesArchaeological2018; @borgman2017big; @marwickStandardScholarlyCitation2018]. The disciplinary culture of archaeology values data as a private personal asset, accumulated for professional prestige, traded for coauthorship, invitations, and other status tokens, and read as an archival text [@andrecostopoulosTraditionalPrestigeEconomy2017]. This is in contrast to 'big' or 'hard' sciences that tend to value data more like a public good, and are incentivised to make data findable, accessible, interoperable, and reusable for efficient analyses beyond the project that collected it [@wallisIfWeShare2013]. This disciplinary culture means that consistently recorded discrete character artefact data are rarely available when combining archaeological datasets collected by different projects. If archaeologists can input continuous data into phylogenetic analyses, then we can avoid the problem of subjectively discretizing measurements into arbitrary classes, and we can greatly expand the scope of potential datasets by taking measurements from drawings and photographs. To date only @cardillo2016morphological and @Cardillo_Charlin_2018 have used continuous data from artefact morphometry for phylogenetic inference (using neighbour-joining and parsimony).

```{r}
#| label: fig-bibliometrics
#| fig-cap: "A: Summary of phylogenetic methods and tools used by archaeologists. B: Network visualisation of co-authors of archaeological phylogenetic publications. C: Number of archaeological phylogenetic publications per year"

knitr::include_graphics(here::here("analysis/figures/fig-bibliometrics.png"))
```

Our network analysis of publications of archaeological phylogenetic studies shows that while papers have been steadily appearing since the mid-2000s, demographic and geographic diversity remains low. Most papers come from two groups of authors, centred on Collard and Prentiss, both of whom use the PAUP\* software. Another dimension of low diversity is in inference methods, with nearly all the papers in our sample using parsimony methods for phylogenetic inference. Among biologists there has been extensive debate over the relative merits of likelihood vs. parsimony in phylogenetic inference [@felsensteinParsimonyLikelihoodExchange1986; @soberContestParsimonyLikelihood2004]. Despite this debate, archaeologists have been constrained to parsimony by their choice of the PAUP\* software, which originally only implemented parsimony methods. For phylogenetic analyses, this means identifying the branching tree structure that requires the least number of evolutionary changes, i.e., the 'best fit' tree for a given data set. While parsimony was popular in phylogeny, particularly in the 1970s and the 1980s, it has several well-understood pitfalls, including failures to find the shortest tree, the shortest tree not being the correct phylogeny (especially when convergent evolution and reversals are present), it does not allow for convergence along long branches as an explanation of similarity, and it does not have an explicit underlying model of evolution [@stewartPowersPitfallsParsimony1993; @steelParsimonyLikelihoodRole2000; @felsensteinCasesWhichParsimony1978]. Furthermore, recent investigations have indicated that probabilistic methods outperform parsimony analyses in terms of accuracy, especially with morphological data [@smithBayesianParsimonyApproaches2019; @oreillyBayesianMethodsOutperform2016; @puttickProbabilisticMethodsOutperform2019; @puttickUncertaintreeDiscriminatingCompeting2017; @wrightBayesianAnalysisUsing2014]. This is important because the evolution of biological morphological characters is far more complex to model than the substitution process of nucleotides or amino acids in linear sequences. For example, morphological traits may not evolve under the continuous time Markov process used in molecular phylogenetics, and assumptions of independence of characters, necessary for parsimony methods, may be violated in morphological matrices [@pyronNovelApproachesPhylogenetic2017]. Archaeological artefact morphologies are likely to have even more complex substitution processes. There are recent signs of archaeologists exploring Bayesian inference as an alternative to parsimony for phylogenetics, albeit using only discrete characters [@gjesfjeld2019contributions; @buckley2017evolution; @buckley2012investigating; @matthews2011testing].

## Bayesian phylogenetic inference and the tripartite model

```{r}
#| label: fig-evo-discpline-schematic
#| fig-cap: "Comparison of major subdivisions within evolutionary biology (left) and corresponding disciplines currently or potentially employed in the study of cultural evolution (right), modified after Figure 1 in Mesoudi et al. 2006. "

knitr::include_graphics(here::here("analysis/figures/evo-discipline-schematic.png"))
```

Taking inspiration from @mesoudiUnifiedScienceCultural2006's proposal of equivalence between evolutionary archaeology and palaeontology [@fig-evo-discpline-schematic] , we find recent phylogenetic work by palaeontologists to be relevant for overcoming the limitations of past archaeological work using discrete characters and parsimony. This is because molecular data are rare in palaeontology so they are motivated to compute phylogenies from morphological data. Recent developments in Bayesian methods for modeling of morphological traits for phylogenetic inference are of particular relevance to archaeologists. Maximum-likelihood and Bayesian approaches have become the preferred means to analyze molecular, cultural and linguistic data, largely replacing parsimony and distance methods [@matzig2023; @huelsenbeckBayesianInferencePhylogeny2001]. Two of the primary advantages of Bayesian methods are, firstly, that the primary analysis will not only find the most probable trees, given the data, rather than the single most parsimonious tree. Secondly, that the primary analysis also simultaneously enables virtually any tree metric to be expressed as a statistical distribution to represent the process that generated the data, and be estimated from the data provide an indication of the uncertainty associated with that parameter, rather than a point estimate [@holderPhylogenyEstimationTraditional2003]. These metrics can include the rates of change and exchange of characters, the distribution of diversification events on a tree, branch lengths, and correlations between characters. Because Bayesian methods deal in distributions, researchers are able to consider both the range of theoretically possible trees and the degree of certainty with which the tree topology can be estimated [@evansUsesAbusesTree2021; @currie2014keeping], which is critical when when working with sparse and incomplete data such as from the archaeological record. These properties, combined with recent substantial improvements in computational efficiency and usability, have rapidly made Bayesian inference a popular tool for exploring complex evolutionary models.

Bayesian inference consists of three parts: (1) likelihood models describing the processes that generated the data (statements of what the researcher believes to be true about their data), with the models containing (2) parameters expressed as statistical distributions representing prior beliefs about the original data generating processes, and (3) posterior distributions of these parameters, generated by computing the likelihood models and priors with the observed data [@wrightSystematistGuideEstimating2019]. The posterior represents the outcome of the model and includes distributions of plausible values for all of the parameters specified in the models, for example tree topologies and divergence times. Calculation of the posterior probabilities is typically too complex to integrate analytically using traditional methods, which is one reason why parsimony methods have been so dominant in phylogenetics. A key breakthrough that has recently made Bayesian phylogenetics more practical is efficient and user-friendly implementations of Markov Chain Monte Carlo (MCMC) sampling for computing the posterior probabilities. MCMC is a simulation technique that randomly draws on values from the priors to construct large numbers of different trees and models of evolution. Each link in the chain is a distinct description of the tree and a certain specification of all the parameters in the model of evolution [@holderPhylogenyEstimationTraditional2003]. Millions of trees are generated using different parameter values, and then scored according to their fit with the observed data, and when new parameter results in a better fit, it is used as the starting point for the next link in the chain [@wrightSystematistGuideEstimating2019]. At the end of the analysis, we get an estimate of the probability that any particular tree is the true evolutionary tree, given the observed data, and estimates of all the parameters of interest [@nascimentoBiologistGuideBayesian2017]. MCMC sampling for Bayesian evolutionary analysis has been implemented in free, open source, extensible and flexible software platforms such as BEAST2, MrBayes, and RevBayes, which are beginning to be explored by archaeologists [@gjesfjeld2019contributions; @buckley2017evolution]. In our case study below we introduce RevBayes because it is the only program with an interactive scripting language and has syntax very similar to the R language [@hohnaPhylogeneticInferenceUsing2017; @hohnaRevBayesBayesianPhylogenetic2016], which is advantageous because R is already widely used by archaeologists [@schmidtToolDrivenRevolutionsArchaeological2020].

```{r}
#| label: fig-tripartite-models
#| fig-cap: "Schematic of the key elements of the three models used in many palaeontological phylogenetic studies. Top row: Substitution models, with examples including binary and multistate models for discrete characters, and Brownian motion for continuous attributes. Middle row: Clock models, with examples including strict clock (with a constant rate among branches), uncorrelated relaxed clock (with a distinct rate along each branch drawn from a chosen probability distribution), and autocorrelated relaxed clock (with a distinct rate along each branch that is correlated with the rate along its parent branch). Bottom row: Tree models, include examples of pure birth (assumes speciation is constant over time, that we have no extinction), birth-death (where are species or variant disappear through extinction), and fossilized birth-death trees (incorporates the fossil recovery process and provides an expression for the probability of observing a tree with samples recovered along internal branches). Tree models allow specification of the speciation rate (λ), extinction rate (μ), and fossil recovery rate (ψ). Adapted from Warnock and Wright (2020), Symonds and Blomberg (2015), and Ho and Duchêne (2014)"

knitr::include_graphics(here::here("analysis/figures/tripartite-model.png"))
```

In palaeontological phylogenetics there are three likelihood models that are the starting points for most analyses: the substitution model, the clock model, and the tree model [@warnockUnderstandingTripartiteApproach2020; @fig-tripartite-models]. Substitution models describe the process the researcher believes generated the character data. There are two main categories, each having several variants: discrete (e.g. Mk) and continuous (e.g. Brownian motion, Ornstein--Uhlenbeck, Lévy processes). Clock models describes the manner in which the researcher believes rates of evolution are distributed across the tree. There are two main groups of clock models: strict (with a constant rate among branches) and and relaxed, with examples including uncorrelated relaxed clock (with a distinct rate along each branch drawn from a chosen probability distribution), and autocorrelated relaxed clock (with a distinct rate along each branch that is correlated with the rate along its parent branch). Tree models describe the extinction, speciation, and sampling events that potentially led to the observed trees. Examples of tree models include pure birth (assumes speciation is constant over time, that we have no extinction), birth-death (where are species or variant disappear through extinction), and fossilized birth-death trees (incorporates the fossil recovery process and provides an expression for the probability of observing a tree with samples recovered along internal branches). The tripartite model is an important framework that enables nearly endless combinations of substitution, clock, and tree models to be assembled into a complete model.

## Continuous characters from archaeological artefact shapes

With the increased emphasis on modelling phylogenetic change in palaeontology came a concern that the discrete character substitution models for used to models change among nucleotides were poorly suited to modelling change in morphological characters. This concern motivated the development of methods to find more appropriate models and include morphological data without loss of information due to discretization. Simulations of palaeontological phylogenies using continuous traits have shown that models of stochastic Markovian movement through continuous trait space result in higher overall accuracy than discrete character models using discretized continuous characters [@parins-fukuchiUseContinuousTraits2018]. Traditional linear dimensions are widely used in palaeontological phylogenetics, but they are limited in the information they capture about shape and the interrelations among the dimensions of the studied structure. To overcome these limitations, palaeontologists have been using of geometric morphometrics to quantify shape as continuous characters to input into phylogenetic models. This includes landmark [@parins-fukuchiMorphologicalPhylogeographicEvidence2021; @alvarez-carreteroBayesianEstimationSpecies2019; @gonzalez-joseCladisticAnalysisContinuous2008] and outline [@smithGeometricMorphometricCharacter2013; @gabelaiaPhylogeneticSignalsScale2017; @lafumaMultipleEvolutionaryOrigins2021 ] methods to summarise shapes, and a variety of multivariate analyses to reduce dimensionality (e.g. PCA), accompanied by vibrant debate for [@gonzalez-joseMorphometricVariablesCan2011a; @zelditch2012geometric] and against [@varon-gonzalezEstimatingPhylogeniesShape2020; @klingenbergTestingQuantifyingPhylogenetic2010; @adamsMorphometricsPhylogeneticsPrincipal2011 ] their effectiveness.

```{r}
#| label: fig-efa-schematic
#| fig-cap: "..."

knitr::include_graphics(here::here("analysis/figures/efa-schematic.png"))
```

Landmark and outline analysis of artefact shape is widely used in archaeology. Landmark-based morphometrics have been widely applied to archaeological objects with obvious morphological features that provide unambiguous reference points for landmark placement, such as tips and edges of stone or metal tools [@Birch2019; @Lycett2013], visually distinctive bone features [@Haruda2019], or ceramic assemblages with distinct components [@Selden2019; @Topi2017]. For artefacts where landmarks are ambiguous or absent, outline approaches, such as Elliptic Fourier Analysis (EFA), are more effective for assessing morphological variations in the whole structure of two-dimensional closed shapes [@Cardillo2010]. EFA uses periodic functions to capture geometric information, where an outline is decomposed into a series of ellipses described by trigonometric functions [@Bonhomme2014]. Coordinates along a curve are converted into Fourier function coefficients, called harmonic coefficients or harmonics [@Kuhl1982]. The number of harmonics determines the quality and precision of the geometric representation of an object. Outline analyses has long been effectively employed in the analysis of stone artefacts [e.g. @Gero1984; @Iovictua2009; @Fox2015; @Lipo2016; @Hoggard2019; @Ivanovaite2020; @riede2019reconciling; @matzig2021] and pottery [@Wilczek2014; @wang2020]. These studies share a standard approach of digitizing artefact shapes, extracting outlines, computing an EFA on these outlines, and then reducing the dimensionality of the harmonics by inputting them into a principal component analysis (PCA). The principal component (PC) scores are then interpreted as artefact shape variables that are typically more informative than linear dimensions. In our case study we extend the use of these artefact shape variables by using them as continuous characters to input into phylogenetic models.

## A birth--death model for Late Neolithic/Early Bronze Age arrowheads from Northwestern Europe

```{r}
library(dplyr)
library(readr)
library(here)

n_artefacts_france_with_chrono_info <- 
read_csv(here("analysis/data/derived_data/data_for_revbayes.csv")) %>% 
  nrow()

n_harmonics_for_99.9 <-
  read_lines(here::here("analysis/data/derived_data/n_harmonics_for_99.9.txt"))

pc_for_99 <-
  read_lines(here::here("analysis/data/derived_data/pc_for_99.txt"))
```

We demonstrate the use of artefact shape variables as continuous characters for phylogenetic modelling using flaked stone arrowheads found in late Neolithic chiefly burials across north-west France, southern Britain and Denmark during 2500 BC and 1700 BC [4500--3700 cal BP, @nicolasArrowsPowerBrittany2017]. These arrowheads, sometimes found in wooden boxes or wrapped in leather, are part of suite of grave goods that include bell-shaped ceramic food vessels, ornaments, and tools made from amber, bronze, copper, gold, silver and other materials. This set of grave goods is known as the Bell Beaker culture that spread across Europe through a mixture of migration and cultural diffusion. The arrowheads were bifacially flaked using antler, bone, and metal indentors, and many have traces of adhesive residue used for halfting onto a shaft. The usewear traces and geometry of halfting indicate that the arrowheads were loosely attached, designed for symbolic displace rather than efficient shots [@nicolasArrowsPowerBrittany2017]. Diagnostic impact fractures are generally absent from the arrowheads, with less than three percent showing signs of having been shot, indicating that most were not used as projectiles, but as non-functional display items. They were likely made by specialist master craft-workers, with the production sequence transmitted through generations, and the final products soley intended to portray and emphasise the social status of the individuals they were buried with. Given that the arrowheads were primarily symbols that were not used as projectiles, we can be confident that shape variation is unrelated to physical performance factors, and instead likely reflects transmission of social values and identities.

```{r}
#| label: fig-pca-arrowheads
#| fig-cap: "The first five principal components from our PCA showing how they capture distinct shape. PC1: tang depth, PC2: shoulder width, PC3: tang height, PC4: tang width, PC5: shoulder symmetry"

knitr::include_graphics(here::here("analysis/figures/nicolas_arrowheads_pca_contrib.png"))
```

We focus on the `r n_artefacts_france_with_chrono_info` arrowheads from sites in France because these have the most complete provenance and chronological information. @nicolasFlechesPouvoirAube2016 provided detailed images of the arrowheads, and a techno-typological classification of these arrowheads projected on the period's chronology, based on metric measurements and morphological observations. We started with the outlines extracted from these images by @matzig2021 and followed their procedure to remove outliers, and compute an EFA to quantitatively describe the outlines as a set of harmonics. We used the `r n_harmonics_for_99.9` harmonics required to capture 99.9% of shape variation. To improve computational efficiency, we reduced the dimensionality of these these harmonics by inputing them into a PCA, keeping the `r pc_for_99` components need to capture 99% of variation in the harmonics. These components are our shape variables that we use as continuous traits to input into our phylogenetic models. @fig-pca-arrowheads illustrates how the principal components capture distinct shape characteristics.

We generated fours models to investigate the most appropriate combination of substitution, clock, and tree models. @tbl-model-summary summarises the model configurations and their marginal likelihoods. Full details of our Bayesian MCMC procedure are documented in our supplementary materials at http://doi.org/xxx/xxx. Taking the first model as the null model, the Bayes Factors indicate strong support for the model using a birth-death tree (where variants can appear and disappear, rather than only appear), relaxed Brownian motion (where the rate of morphological change is allowed to vary among branches of the phylogeny) and a relaxed clock (allowing for shifts in rates of morphological change across branches). @fig-treemap-densitree-map summarises the phylogenetic landscape, with the top left panel showing a single cluster of related trees, indicating that one phylogeny is definitively supported by the data [@jombartTreespaceStatisticalExploration2017]. The top right panel is a Densitree plot of trees randomly sampled from the converged posterior to provide intuition about the extent of incongruence among these trees [@bouckaertDensiTreeMakingSense2010]. It shows high congruence for the Bronze A2 and Bell Beaker samples, but substantial uncertainty for the Bronze A1 arrowheads, indicating competing topologies and possibly horizontal transmission and independent convergence on similar shapes.

```{r}
#| label: tbl-model-summary
#| tbl-cap:  "Summary of phygenetic models explored with the arrowhead data"

model_summary_tbl_nums <- 
read_csv(here("analysis/data/derived_data/model_summary_tbl_nums.csv")) 

knitr::kable(model_summary_tbl_nums)
```

The middle and lower panel of @fig-treemap-densitree-map demonstrates the presence of a phylogenetic signal in our data. This is the tendency for related artefacts to resemble each other more than they resemble species drawn at random from the tree [@blombergTestingPhylogeneticSignal2003]. The middle panel shows the maximum a posteriori topology which is the tree that has the greatest posterior probability, averaged over all branch lengths and substitution parameter values. The middle panel also shows the strength of phylogenetic signal for each shape variable via the Local Indicator of Phylogenetic Association (local Moran's I) for each specimen and trait to indicate hotspots of association [@keckPhylosignalPackageMeasure2016]. The bottom panel of @fig-treemap-densitree-map show's Pagel's lambda values for our traits, nearly all are \~1 with p \< 0.05, indicating that there is a significant phylogenetic signal for all traits in our model, compared to a random model of evolution (lambda \~ 0).

```{r}
#| label: fig-treemap-densitree-map
#| fig-cap: "Exploration of landscapes of phylogenetic trees. Top left: Pairwise Euclidean distances between trees decomposed into a low-dimensional space using multidimensional scaling (MDS); top right: Densitree of all trees in the set drawn transparently, areas where a lot of the trees agree in topology and branch lengths show up as highly colored areas, while areas with little agreement show up as webs; middle panel:local Moran's I for each shape variable to detect hotspots of autocorrelation, red bars indicate significant I values (p < 0.01), indicating phylogenetic signal.; bottom panel: Pagel's lamba values for each shape variable, all have p < 0.05."
#| fig-height: 10
#| fig-width: 7
#| out-height: "500"

knitr::include_graphics(here::here("analysis/figures/treespace-densitree-map-signal-lamdba.png"))

```

Overall the tree is consistent with the traditional scheme of typological evolution presented by @nicolasFlechesPouvoirAube2016 in showing the Bell Beaker and three major phases of Bronze Age production as mostly coherent clades. Arrowheads from Early Bronze Age 2 and 3 show much greater coherence than those from Early Bronze Age 1, with several find locations appearing in a single clade. One interpretation of this could be that during EBA-1, arrowheads for a single burial were sourced from a variety of craft workers, representing different lineages of arrow making. Later, in EBA-2 and 3, most or all of the arrowheads placed in a burial were sourced from a single master craft worker.

The relaxed clock model provides insights into how rates of change in artefact shape varied across the tree. The left panel of @fig-tree-rates-morpho shows that rates of evolution are mostly fairly even across most the tree, with the slowest rates in an EBA-1 clade and the fastest rates in an EBA-2 clade. One interpretation of this is that the craft workers that made the earliest arrowheads were conservative in their exploration of shape possibilities as they were making their first appearance, then briefly experimented with a faster rate of change as use of the arrowheads became more established. Perhaps a conformist bias was at work as the arrowheads initially became established as burial goods. The right panel of @fig-tree-rates-morpho shows the distribution of trait values across the tree for the first five principal components, as our primary shape variables, and projections of the tree onto the morphospace for each combination of these variables. This shows that the deep tang (PC1) and narrow shoulders (PC2) were characteristics typical of the clades representing the middle of study period. We can also see that the area of the tree with highest rates of change has extreme values of (PC1: deep tang), indicating that much of the change occurred in that trait.

```{r}
#| label: fig-tree-rates-morpho
#| fig-cap: "Left: Rates of evolution across the tree; Right: multidimensional phylogenetic phylomorphospace scatterplot matrix"
#| fig-height: 10
#| fig-width: 7
#| out-height: "500"

knitr::include_graphics(here::here("analysis/figures/tree-rates-morphospace.png"))

```

## Discussion and Conclusion

Our brief case study demonstrates an accessible workflow using open source software tools for reconstructing phylogenetic relationships among archaeological artefacts. We have demonstrated how continuous characters, in the form of shape variables derived from geometric morphometry, which have become a popular way of quantitatively describing complex artefacts [@matzig2023], can be input into a phylogenetic model to yield easily interpretable output. The arrowheads of our case study are suitable because their shape did not change over the use-life of the artefact -- they were produced as grave goods and not used as projectiles. Other artefacts made using reductive techniques, such as Mousterian scrapers, might not be suitable for this kind of analysis because their shape changes substantially over their use-life [@dibbleInterpretationMiddlePaleolithic1987], independent of vertical transmission of cultural information about artefact shape.

Our use of Bayesian methods has provided formal approaches to manage competing models about the processes that generated the data, and methods for formalising uncertainty. These can be contrasted with previous work using parsimony methods that typically do not convey error estimates. However, Bayesian methods presents new challenges in the selection of appropriate models and prior parameter distributions. We anticipate that ethnographic and detailed archaeological data on transmission dynamics may help here. 

This brief case study yielded promising results and sketches a straightforward template for future work in archaeological phylogenetics. We have demonstrated a model-based Bayesian workflow, and how to convey uncertainty, obtain insights about phylogenetic signal, and rates and locations of change. This case study could be extended with samples from a larger area, for example South Britain and Denmark @nicolasFlechesPouvoirAube2016], and by parallel analyses of other artefact classes found with the burials. More generally whole 'society' transmission dynamics or contrasting transmission across genders could also be explored with these methods. At much broader scales, phylogenetic/macroevolutionary studies of gene-culture co-evolution may be possible, as well as exploration of cultural phylogeography and niche construction dynamics using comparative methods.

## Acknowledgements

## Author Contributions

## Financial Support

## Conflicts of Interest

Conflicts of Interest: Author A and Author B declare none

## Research Transparency and Reproducibility

<!-- The following line inserts a page break  -->

\newpage

# References

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r}
#| label: colophon
#| cache: false

# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
